# AI и Большие языковые модели (LLM)

**Дата создания:** 2025-12-13
**Последнее обновление:** 2025-12-15 ⚠️ АКТУАЛИЗИРОВАНО
**Приоритет:** ⭐⭐⭐⭐⭐ (Критический — основа всего проекта)

---

## ⚠️ АКТУАЛЬНО НА ДЕКАБРЬ 2025

**Рекомендации обновлены с учётом последних релизов:**
- ✅ **GPT-5.2** (релиз 11 декабря 2025) — текущая топовая модель OpenAI
- ✅ **Gemini 3.0 Pro** (доступен в API)
- ✅ **Claude 3.5 Sonnet** (стабильная альтернатива)

**Детальное сравнение:** [00-gpt-vs-gemini-comparison.md](00-gpt-vs-gemini-comparison.md)

---

## Назначение

Большие языковые модели (LLM) — это "мозг" платформы. Они используются во ВСЕХ ИИ-агентах для анализа документов, генерации текста, принятия решений.

---

## Рекомендуемая связка

### Основной стек: OpenAI GPT-5.2 + LangChain

```
┌─────────────────────────────────────────┐
│         LangChain Framework             │
│  (оркестрация AI-агентов)               │
├─────────────────────────────────────────┤
│         OpenAI API (GPT-5.2)            │
│  - gpt-5.2-instant для БОЛЬШИНСТВА задач│
│  - gpt-5.2-thinking для СЛОЖНОГО анализа│
│  - gpt-5-mini для ПРОСТЫХ задач         │
│                                         │
│  Fallback:                              │
│  - claude-3-5-sonnet (если OpenAI упал) │
│  - gemini-3-0-pro (для больших доков)   │
└─────────────────────────────────────────┘
```

**Стоимость:** ~$2.50 на комплект ИД
**Скорость:** Оптимальная (GPT-5.2 Instant быстрее GPT-4o)
**Надёжность:** Высокая (прошла code red OpenAI)

---

## Конкретные инструменты

### 1. OpenAI GPT-5.2 (ОСНОВНАЯ МОДЕЛЬ)

**Что это:**
- Новейшая модель OpenAI (релиз 11 декабря 2025)
- 3 режима: Instant, Thinking, Pro
- 400K контекстное окно, 128K max output
- Лучшая модель для профессиональных задач

**Технические характеристики:**
- **Контекст:** 400,000 токенов (vs 128K у GPT-4o)
- **Max output:** 128,000 токенов
- **Knowledge cutoff:** 31 августа 2025
- **Производительность:** 55.6% на SWE-Bench Pro (реальные инженерные задачи)

**Три режима GPT-5.2:**

| Режим | Использование | Цена (за 1M токенов) | Кэш (90% скидка) |
|-------|---------------|----------------------|------------------|
| **Instant** | Повседневные задачи, быстрые ответы | $1.75 / $14 | $0.175 / $1.40 |
| **Thinking** | Сложный анализ, структурированная работа | $1.75 / $14 | $0.175 / $1.40 |
| **Pro** | Максимальная точность, критичные задачи | $21 / $168 | $2.10 / $16.80 |

**Почему именно GPT-5.2:**
- ✅ **Стабильный** — прошёл code red OpenAI после Gemini 3
- ✅ **Быстрый** — Instant режим оптимизирован для скорости
- ✅ **Умный** — 70.9% побед над профессионалами на 44 профессиях
- ✅ **Универсальный** — отличное понимание длинных документов
- ✅ **Выгодный** — 90% скидка на кэшированные запросы

**Установка:**
```bash
pip install openai
```

**Пример использования:**
```python
from openai import OpenAI

client = OpenAI(api_key="sk-...")

response = client.chat.completions.create(
    model="gpt-5.2-instant",  # Основная модель для большинства задач
    messages=[
        {"role": "system", "content": "Ты эксперт по анализу проектной документации в строительстве."},
        {"role": "user", "content": "Проанализируй эту спецификацию и определи необходимые АОСР..."}
    ],
    temperature=0.2,  # Низкая температура для точности
    max_tokens=4000
)

print(response.choices[0].message.content)
```

**Пример с кэшированием (экономия 90%):**
```python
response = client.chat.completions.create(
    model="gpt-5.2-instant",
    messages=[
        {
            "role": "system",
            "content": """Ты эксперт по строительной документации.

            БАЗА ЗНАНИЙ (будет закэширована):
            - АОСР создаются согласно СП 48.13330.2019
            - Каждая скрытая работа требует акта
            - Акты подписывают: мастер, ИТР, заказчик
            ... (большой промпт с правилами)
            """
        },
        {"role": "user", "content": "Создай АОСР для монтажа труб"}
    ],
    temperature=0.2
)
```

**Официальный сайт:** https://platform.openai.com/docs

---

### 2. GPT-5 Mini (Экономичная модель)

**Что это:**
- Быстрая и дешёвая модель для простых задач
- Замена GPT-4o-mini

**Цены:**
- **GPT-5 nano:** $0.05 input / $0.40 output за 1M токенов
- **GPT-5 mini:** $0.25 input / $2.00 output за 1M токенов
- **GPT-5:** $1.25 input / $10.00 output за 1M токенов

**Когда использовать:**
- ✅ Классификация типов документов
- ✅ Простая генерация текста по шаблону
- ✅ Извлечение структурированных данных из чистого текста
- ❌ НЕ использовать для анализа сложных документов

**Пример:**
```python
response = client.chat.completions.create(
    model="gpt-5-mini",  # Дешёвая модель для простых задач
    messages=[
        {"role": "system", "content": "Определи тип документа качества."},
        {"role": "user", "content": "Сертификат соответствия №..."}
    ]
)
```

---

### 3. LangChain (Фреймворк для AI-агентов)

**Что это:**
- Фреймворк для создания приложений на базе LLM
- Позволяет создавать цепочки действий (chains) и агентов
- Управляет памятью, промптами, интеграциями

**Установка:**
```bash
pip install langchain langchain-openai
```

**Пример создания агента:**
```python
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.chains import LLMChain

# Инициализация LLM
llm = ChatOpenAI(
    model="gpt-5.2-instant",
    temperature=0.2,
    api_key="sk-..."
)

# Создание промпта
prompt = ChatPromptTemplate.from_messages([
    ("system", "Ты агент для анализа проектной документации."),
    ("human", "{input}")
])

# Создание цепочки
chain = LLMChain(llm=llm, prompt=prompt)

# Использование
result = chain.invoke({"input": "Проанализируй спецификацию..."})
print(result["text"])
```

---

## Альтернативные варианты

### Fallback 1: Anthropic Claude 3.5 Sonnet (РЕКОМЕНДУЕТСЯ)

**Что это:**
- Надёжная альтернатива если OpenAI недоступен
- Качество близко к GPT-5.2
- Отличная работа с длинными документами (200K контекст)

**Когда использовать:**
- ✅ Если OpenAI API недоступен
- ✅ Если документы очень большие (>100 страниц)
- ✅ Как резервный вариант для критичных задач

**Стоимость (декабрь 2025):**
- **Input:** $3.00 за 1M токенов
- **Output:** $15.00 за 1M токенов
- **Long context (>200K):** $6.00 / $22.50 за 1M токенов
- **Batch API:** 50% скидка ($1.50 / $7.50)
- **Prompt caching:** кэш читается за 0.1× базовой цены

```bash
pip install anthropic
```

```python
from anthropic import Anthropic

client = Anthropic(api_key="sk-ant-...")

message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=4096,
    messages=[
        {"role": "user", "content": "Проанализируй проектную документацию..."}
    ]
)

print(message.content[0].text)
```

---

### Fallback 2: Google Gemini 3.0 Pro

**Что это:**
- Новейшая модель Google (конкурент GPT-5.2)
- Огромный контекст (2M токенов)
- Мультимодальность (текст + изображения + видео)

**Когда использовать:**
- ✅ Документы >200 страниц (используйте long context)
- ✅ Анализ видео с объектов
- ⚠️ Только как резервный вариант

**Стоимость (декабрь 2025):**
- **Standard context (≤200K):** $2.00 input / $12.00 output за 1M токенов
- **Long context (>200K):** $4.00 input / $18.00 output за 1M токенов
- **Статус:** Платная модель (бесплатный tier недоступен)

**Примечание:** Gemini 3.0 Pro находится в preview, стабильный релиз ожидается Q1 2026.

---

## Архитектура использования в проекте

### Распределение моделей по агентам (РЕКОМЕНДОВАНО)

```
┌─────────────────────────────────────────────────────┐
│         AI-агенты платформы (декабрь 2025)          │
├─────────────────────────────────────────────────────┤
│                                                     │
│  [Агент анализа РД] ⭐⭐⭐⭐⭐                        │
│  └─ GPT-5.2 Instant (быстро + качественно)         │
│     Расход: ~40K input + 20K output = $0.98         │
│                                                     │
│  [Агент генерации АОСР] ⭐⭐⭐⭐                      │
│  └─ GPT-5.2 Instant (оптимальный баланс)           │
│     Расход: 10 актов × $0.12 = $1.20                │
│                                                     │
│  [Агент поиска документов качества] ⭐⭐⭐            │
│  └─ GPT-5 mini (простая классификация)             │
│     Расход: ~$0.10                                  │
│                                                     │
│  [Агент генерации документов качества] ⭐⭐          │
│  └─ GPT-5 mini (шаблонная задача, экономия)        │
│     Расход: ~$0.05                                  │
│                                                     │
│  [Агент проверки комплектности] ⭐⭐⭐⭐⭐            │
│  └─ GPT-5.2 Thinking (критично, нужна точность!)   │
│     Расход: ~$0.15                                  │
│                                                     │
│  [Агент анализа сканов (OCR)] ⭐⭐⭐⭐                │
│  └─ GPT-5.2 Vision (работа с изображениями)        │
│     Расход: ~$0.35 (100 документов)                │
│                                                     │
│  [Fallback для всех агентов]                        │
│  └─ Claude 3.5 Sonnet (если OpenAI недоступен)     │
│                                                     │
│  [Long documents (>200 страниц)]                    │
│  └─ Gemini 3.0 Pro (огромный контекст)             │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**ИТОГО на комплект ИД:** ~$2.50

---

## Оценка стоимости API

### Детальный расчет для 1 проекта (комплект ИД)

**Вводные:**
- Анализ РД: ~60K токенов (промпт + ответ)
- Генерация 10 АОСР: ~120K токенов
- Поиск документов качества: ~40K токенов
- Генерация документов качества: ~20K токенов
- Проверка комплектности: ~20K токенов
- OCR сканов: ~100 изображений

**Стоимость с GPT-5.2 Instant:**

| Задача | Input | Output | Стоимость |
|--------|-------|--------|-----------|
| Анализ РД | 40K × $1.75/1M | 20K × $14/1M | $0.35 |
| Генерация 10 АОСР | 80K × $1.75/1M | 40K × $14/1M | $0.70 |
| Поиск документов (GPT-5 mini) | 30K × $0.25/1M | 10K × $2/1M | $0.03 |
| Генерация док. качества (GPT-5 mini) | 15K × $0.25/1M | 5K × $2/1M | $0.01 |
| Проверка (GPT-5.2 Thinking) | 15K × $1.75/1M | 5K × $14/1M | $0.10 |
| OCR 100 сканов (GPT-5.2 Vision) | — | — | $0.80 |
| **ИТОГО** | | | **~$2.00** |

**С учётом кэширования (90% скидка на повторяющиеся промпты):**
- Реальная стоимость: **~$1.50-1.80 на проект**

**При 100 проектах в месяц:** $150-180/месяц на LLM API

---

## Хранение промптов

### LangSmith (для мониторинга и улучшения)

**Что это:**
- Платформа от создателей LangChain
- Отслеживание всех запросов к LLM
- Улучшение промптов
- Дебаггинг цепочек агентов

**Установка:**
```bash
pip install langsmith
```

**Настройка:**
```python
import os
os.environ["LANGCHAIN_TRACING_V2"] = "true"
os.environ["LANGCHAIN_API_KEY"] = "ls__..."
os.environ["LANGCHAIN_PROJECT"] = "pto-platform"
```

**Официальный сайт:** https://smith.langchain.com/

---

## Рекомендации по использованию

### ✅ Лучшие практики

1. **Используйте разные модели для разных задач:**
   - Сложные задачи → GPT-5.2 Instant/Thinking
   - Массовые задачи → GPT-5 mini
   - Критичные задачи → GPT-5.2 Thinking с валидацией

2. **Низкая температура для точности:**
   - Temperature = 0.1-0.3 для генерации актов
   - Temperature = 0.5-0.7 для креативных задач

3. **Используйте system prompts:**
   - Всегда задавайте роль и контекст
   - Примеры хороших и плохих ответов

4. **Кэшируйте базовые знания:**
   - Регламенты, правила, ГОСТы
   - 90% экономия на повторяющихся промптах

5. **Структурируйте вывод:**
   - Используйте JSON Schema для парсинга ответов
   - Function calling OpenAI

6. **Кэшируйте результаты в БД:**
   - Не запрашивайте одно и то же дважды
   - Используйте Redis для кэширования промежуточных результатов

---

### ❌ Чего избегать

1. **НЕ отправляйте слишком большие документы за раз:**
   - Разбивайте на чанки
   - Используйте RAG (Retrieval-Augmented Generation)

2. **НЕ доверяйте LLM на 100%:**
   - Всегда добавляйте валидацию результатов
   - Критичные проверки дублируйте программно

3. **НЕ используйте одну модель для всего:**
   - Это дорого и неэффективно

4. **НЕ игнорируйте кэширование:**
   - 90% экономия на GPT-5.2!

---

## Следующие шаги

1. **Зарегистрироваться на OpenAI Platform:**
   - https://platform.openai.com/signup

2. **Получить API ключ:**
   - https://platform.openai.com/api-keys

3. **Установить лимиты расходов:**
   - Настроить billing limits в личном кабинете

4. **Начать с простого агента:**
   - Создать тестовый агент для генерации одного АОСР

5. **Подключить LangSmith для мониторинга:**
   - https://smith.langchain.com/

---

## Связь с другими компонентами

- **[OCR](02-ocr.md):** LLM используется для анализа распознанного текста
- **[Backend](03-backend.md):** API интеграция с LLM через Python
- **[Database](08-database.md):** Хранение промптов и истории запросов
- **[Cloud](07-cloud.md):** Хостинг агентов в облаке

---

## Источники (актуально на декабрь 2025)

- [OpenAI GPT-5.2 Release](https://openai.com/index/introducing-gpt-5-2/)
- [OpenAI API Pricing](https://openai.com/api/pricing/)
- [LLM API Pricing Comparison 2025](https://intuitionlabs.ai/articles/llm-api-pricing-comparison-2025)
- [Claude 3.5 Sonnet Pricing](https://costgoat.com/pricing/claude-api)
- [Gemini 3.0 Pro Pricing](https://www.glbgpt.com/hub/gemini-3-pro-costs-gemini-3-api-costs-latest-insights-for-2025/)

---

**Статус:** ✅ Готово к использованию
**Последнее обновление:** 2025-12-15 (актуализированы модели OpenAI и цены)
