# ะะฐะบ ัะฐะฑะพัะฐะตั ะฟะปะฐััะพัะผะฐ (ะฟัะพัััะผะธ ัะปะพะฒะฐะผะธ)

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 2025-12-14
**ะะปั ะบะพะณะพ:** ะะปั ะฒัะตั, ะบัะพ ัะพัะตั ะฟะพะฝััั, ะบะฐะบ ััััะพะตะฝะฐ ะฟะปะฐััะพัะผะฐ ะธะทะฝัััะธ

---

## ๐ฏ ะะปะฐะฒะฝะฐั ะทะฐะดะฐัะฐ

**ะัะตะฒัะฐัะธัั:**
- ะััะดั ะดะพะบัะผะตะฝัะพะฒ (ะฟัะพะตะบัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั, ัะบะฐะฝั ัะตััะธัะธะบะฐัะพะฒ, ััะตะผั)

**ะ:**
- ะะพัะพะฒัะน ะบะพะผะฟะปะตะบั ะธัะฟะพะปะฝะธัะตะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ (ะฐะบัั, ัะตะตัััั, ะฒัั ะพัะพัะผะปะตะฝะพ ะฟะพ ะะะกะขั)

**ะะฐ:**
- 1 ะดะตะฝั ะฒะผะตััะพ ะฝะตะดะตะปะธ

---

## ๐๏ธ ะััะพะบะพััะพะฒะฝะตะฒะฐั ะฐััะธัะตะบัััะฐ

ะัะตะดััะฐะฒััะต ะฟะปะฐััะพัะผั ะบะฐะบ **ะบะพะฝะฒะตะนะตั ะฝะฐ ะทะฐะฒะพะดะต**:

### ะะฝัะตัะฐะบัะธะฒะฝะฐั ะดะธะฐะณัะฐะผะผะฐ (Mermaid)

```mermaid
graph TB
    User[๐ค ะะฝะถะตะฝะตั ะะขะ] -->|ะะฐะณััะถะฐะตั ะดะพะบัะผะตะฝัั| Frontend[๐ฅ๏ธ ะคัะพะฝัะตะฝะด React]
    Frontend -->|HTTP POST /api/documents| Backend[โ๏ธ Backend FastAPI]
    Backend -->|ะกะพััะฐะฝัะตั ัะฐะนะป| Storage[(๐ฆ Object Storage)]
    Backend -->|ะกะพะทะดะฐัั ะทะฐะฟะธัั| DB[(๐พ PostgreSQL)]
    Backend -->|ะกัะฐะฒะธั ะทะฐะดะฐัั| Queue[๐ฌ Redis Queue]
    Queue -->|ะะฐะฑะธัะฐะตั ะทะฐะดะฐัั| Celery[โก Celery Worker]

    Celery --> OCR[๐ค OCR ะะณะตะฝั]
    Celery --> RDAnalysis[๐ค ะะณะตะฝั ะฐะฝะฐะปะธะทะฐ ะะ]
    Celery --> AOSRGen[๐ค ะะณะตะฝั ะณะตะฝะตัะฐัะธะธ ะะะกะ]
    Celery --> DocSearch[๐ค ะะณะตะฝั ะฟะพะธัะบะฐ ะดะพะบัะผะตะฝัะพะฒ]
    Celery --> Validation[๐ค ะะณะตะฝั ะฟัะพะฒะตัะบะธ]

    OCR -->|ะะตะทัะปััะฐั| DB
    RDAnalysis -->|ะะตะทัะปััะฐั| DB
    AOSRGen -->|PDF| Storage
    AOSRGen -->|ะะตัะฐะดะฐะฝะฝัะต| DB
    DocSearch -->|ะะฐะนะดะตะฝะฝัะต ะดะพะบัะผะตะฝัั| Storage
    Validation -->|ะกัะฐััั| DB

    DB -->|ะะพะปััะฐะตั ะดะฐะฝะฝัะต| Frontend
    Frontend -->|ะะพะบะฐะทัะฒะฐะตั ัะตะทัะปััะฐั| User

    style User fill:#e1f5ff
    style Frontend fill:#ffe1f5
    style Backend fill:#fff5e1
    style Storage fill:#e1ffe1
    style DB fill:#e1e1ff
    style Queue fill:#ffe1e1
    style Celery fill:#f5e1ff
```

### ะขะตะบััะพะฒะฐั ะดะธะฐะณัะฐะผะผะฐ (ะดะปั ัะตัะผะธะฝะฐะปะฐ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะญะขะะ 1: ะะะะะ ะะะะะะ                       โ
โ                         (ะคัะพะฝัะตะฝะด)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  ๐ค ะะฝะถะตะฝะตั ะะขะ ะพัะบััะฒะฐะตั ะฑัะฐัะทะตั                             โ
โ  โ ะะฐัะพะดะธั ะฝะฐ ะฟะปะฐััะพัะผั (React ะฟัะธะปะพะถะตะฝะธะต)                    โ
โ  โ ะะธะดะธั ัะฟะธัะพะบ ัะฒะพะธั ะฟัะพะตะบัะพะฒ                                โ
โ  โ ะกะพะทะดะฐัั ะฝะพะฒัะน ะฟัะพะตะบั ะธะปะธ ะฒัะฑะธัะฐะตั ัััะตััะฒัััะธะน             โ
โ  โ ะะฐะณััะถะฐะตั ะดะพะบัะผะตะฝัั (PDF, Word, ัะบะฐะฝั)                     โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ ะัะฟัะฐะฒะปัะตั HTTP ะทะฐะฟัะพั
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ะญะขะะ 2: ะะะะะะะขะะ ะะะะะะ                     โ
โ                        (Backend API)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  โ๏ธ FastAPI ะฟัะธะฝะธะผะฐะตั ะทะฐะฟัะพั                                  โ
โ  โ ะัะพะฒะตััะตั: ะฟะพะปัะทะพะฒะฐัะตะปั ะฐะฒัะพัะธะทะพะฒะฐะฝ?                       โ
โ  โ ะกะพััะฐะฝัะตั ัะฐะนะป ะฒ Object Storage (ะพะฑะปะฐัะฝะพะต ััะฐะฝะธะปะธัะต)       โ
โ  โ ะกะพะทะดะฐัั ะทะฐะฟะธัั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั                               โ
โ  โ ะกัะฐะฒะธั ะทะฐะดะฐัั ะฒ ะพัะตัะตะดั: "ะะฑัะฐะฑะพัะฐัั ััะพั ะดะพะบัะผะตะฝั!"       โ
โ  โ ะะพะทะฒัะฐัะฐะตั ััะพะฝัะตะฝะดั: "ะัะธะฝััะพ, ะพะฑัะฐะฑะฐััะฒะฐะตััั..."         โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ ะะฐะดะฐัะฐ ะฒ ะพัะตัะตะดั
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ะญะขะะ 3: ะคะะะะะะฏ ะะะะะะะขะะ                    โ
โ                      (Celery Workers)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  ๐ฆ Celery ะฑะตััั ะทะฐะดะฐัั ะธะท ะพัะตัะตะดะธ (Redis)                    โ
โ  โ "ะัะถะฝะพ ะพะฑัะฐะฑะพัะฐัั ะดะพะบัะผะตะฝั ะฟัะพะตะบัะฐ #123"                   โ
โ  โ ะะฐะฟััะบะฐะตั ะฝัะถะฝะพะณะพ ะะ-ะฐะณะตะฝัะฐ                                โ
โ  โ ะะณะตะฝั ะดะตะปะฐะตั ัะฒะพั ัะฐะฑะพัั                                   โ
โ  โ ะะตะทัะปััะฐั ัะพััะฐะฝัะตััั ะฒ ะฑะฐะทั ะดะฐะฝะฝัั                        โ
โ  โ ะกัะฐััั ะพะฑะฝะพะฒะปัะตััั: "ะะพัะพะฒะพ!"                              โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ ะะ-ะฐะณะตะฝัั ัะฐะฑะพัะฐัั
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะญะขะะ 4: ะะ-ะะะะะฏ                          โ
โ                        (AI Agents)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  ๐ค ะะฐะทะฝัะต ะฐะณะตะฝัั ะดะตะปะฐัั ัะฐะทะฝัั ัะฐะฑะพัั:                       โ
โ                                                               โ
โ  [ะะณะตะฝั OCR]                                                  โ
โ  โ ะะฐัะฟะพะทะฝะฐัั ัะตะบัั ะฝะฐ ัะบะฐะฝะฐั ะดะพะบัะผะตะฝัะพะฒ                      โ
โ  โ ะะทะฒะปะตะบะฐะตั: ะฝะพะผะตั ัะตััะธัะธะบะฐัะฐ, ะดะฐัั, ะฟัะพะธะทะฒะพะดะธัะตะปั          โ
โ                                                               โ
โ  [ะะณะตะฝั ะฐะฝะฐะปะธะทะฐ ะะ]                                           โ
โ  โ ะงะธัะฐะตั ะฟัะพะตะบัะฝัั ะดะพะบัะผะตะฝัะฐัะธั                              โ
โ  โ ะะพะฝะธะผะฐะตั: ะบะฐะบะธะต ัะฐะฑะพัั, ะบะฐะบะธะต ะผะฐัะตัะธะฐะปั, ัะบะพะปัะบะพ ะะะกะ      โ
โ                                                               โ
โ  [ะะณะตะฝั ะณะตะฝะตัะฐัะธะธ ะะะกะ]                                       โ
โ  โ ะะตััั ะดะฐะฝะฝัะต ะธะท ะะ                                         โ
โ  โ ะะตะฝะตัะธััะตั ัะตะบัั ะฐะบัะฐ ะฟะพ ัะฐะฑะปะพะฝั ะะะกะข                      โ
โ  โ ะกะพะทะดะฐัั PDF ัะฐะนะป                                           โ
โ                                                               โ
โ  [ะะณะตะฝั ะฟะพะธัะบะฐ ะดะพะบัะผะตะฝัะพะฒ]                                    โ
โ  โ ะัะตั ะฝะตะดะพััะฐััะธะต ัะตััะธัะธะบะฐัั ะฒ ะธะฝัะตัะฝะตัะต                   โ
โ  โ ะัะพะฒะตััะตั: ะฟะพะดัะพะดะธั ะปะธ ะฝะฐะนะดะตะฝะฝัะน ะดะพะบัะผะตะฝั                  โ
โ  โ ะกะบะฐัะธะฒะฐะตั ะธ ะดะพะฑะฐะฒะปัะตั ะฒ ะฟัะพะตะบั                             โ
โ                                                               โ
โ  [ะะณะตะฝั ะฟัะพะฒะตัะบะธ]                                             โ
โ  โ ะัะพะฒะตััะตั: ะฒัะต ะปะธ ะดะพะบัะผะตะฝัั ะฝะฐ ะผะตััะต?                      โ
โ  โ ะกะฒะตััะตั ะดะฐัั: ะฝะตั ะปะธ ะฝะตัะพะพัะฒะตัััะฒะธะน?                       โ
โ  โ ะคะพัะผะธััะตั ัะฟะธัะพะบ ะทะฐะผะตัะฐะฝะธะน                                 โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ ะะตะทัะปััะฐัั ะฒ ะฑะฐะทั
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ะญะขะะ 5: ะฅะะะะะะะ ะะะะะซะฅ                     โ
โ                      (PostgreSQL)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  ๐พ ะ ะฑะฐะทะต ะดะฐะฝะฝัั ััะฐะฝะธััั:                                   โ
โ  โ ะัะพะตะบัั (ะฝะฐะทะฒะฐะฝะธะต, ะฐะดัะตั, ััะฐััั)                          โ
โ  โ ะะพะบัะผะตะฝัั (ัะฐะนะปั, ะผะตัะฐะดะฐะฝะฝัะต, OCR ัะตะบัั)                   โ
โ  โ ะะะกะ (ัะพะดะตัะถะธะผะพะต, ัะฒัะทั ั ะดะพะบัะผะตะฝัะฐะผะธ)                     โ
โ  โ ะััะพัะธั ะทะฐะดะฐั (ััะพ ะดะตะปะฐะปะธ, ะบะพะณะดะฐ, ัะตะทัะปััะฐั)               โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ ะะฐะฝะฝัะต ะดะพัััะฟะฝั
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ะญะขะะ 6: ะะะะฃะงะะะะ ะะะะฃะะฌะขะะขะ                 โ
โ                         (ะคัะพะฝัะตะฝะด)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  ๐ค ะะฝะถะตะฝะตั ะฒะธะดะธั:                                            โ
โ  โ ะัะพะณัะตัั-ะฑะฐั: "ะะฑัะฐะฑะพัะบะฐ ะทะฐะฒะตััะตะฝะฐ"                        โ
โ  โ ะกะฟะธัะพะบ ะณะพัะพะฒัั ะฐะบัะพะฒ                                       โ
โ  โ ะะฝะพะฟะบะฐ "ะกะบะฐัะฐัั ะบะพะผะฟะปะตะบั ะะ" (PDF)                         โ
โ  โ ะกะฟะธัะพะบ ะทะฐะผะตัะฐะฝะธะน (ะตัะปะธ ะตััั)                               โ
โ                                                               โ
โ  ะะฐะถะธะผะฐะตั "ะกะบะฐัะฐัั" โ ะฟะพะปััะฐะตั ะณะพัะพะฒัะน PDF                    โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพะปะฝัะน ะถะธะทะฝะตะฝะฝัะน ัะธะบะป (ะฟัะธะผะตั)

ะะฐะฒะฐะนัะต ะฟัะพัะปะตะดะธะผ, ััะพ ะฟัะพะธััะพะดะธั, ะบะพะณะดะฐ ะธะฝะถะตะฝะตั ะะขะ ะณะพัะพะฒะธั ะะะกะ ะฝะฐ ะผะพะฝัะฐะถ ัััะฑ:

### ะจะะ 1: ะะฝะถะตะฝะตั ะทะฐะณััะถะฐะตั ะดะพะบัะผะตะฝัั

**ะงัะพ ะดะตะปะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั:**
```
1. ะัะบััะฒะฐะตั ะฟัะพะตะบั "ะะ ะกะพะปะฝะตัะฝัะน, ะบะพัะฟัั 1"
2. ะะฐะถะธะผะฐะตั "ะะฐะณััะทะธัั ะฟัะพะตะบัะฝัั ะดะพะบัะผะตะฝัะฐัะธั"
3. ะัะฑะธัะฐะตั ัะฐะนะป: "ะะฐะทะดะตะป ะะ. ะะพะดะพัะฝะฐะฑะถะตะฝะธะต.pdf"
4. ะะฐะถะธะผะฐะตั "ะะฐะณััะทะธัั"
```

**ะงัะพ ะฟัะพะธััะพะดะธั ะฒะฝัััะธ:**
```
ะคัะพะฝัะตะฝะด (React):
โโ ะะฐะปะธะดะธััะตั ัะฐะนะป (ัะพัะผะฐั PDF, ัะฐะทะผะตั <50MB)
โโ ะะพะบะฐะทัะฒะฐะตั ะฟัะพะณัะตัั-ะฑะฐั ะทะฐะณััะทะบะธ
โโ ะัะฟัะฐะฒะปัะตั POST ะทะฐะฟัะพั ะฝะฐ /api/v1/documents/upload

Backend (FastAPI):
โโ ะะพะปััะฐะตั ัะฐะนะป
โโ ะัะพะฒะตััะตั ะฐะฒัะพัะธะทะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
โโ ะกะพััะฐะฝัะตั ัะฐะนะป ะฒ Object Storage (Yandex Cloud)
โโ ะกะพะทะดะฐัั ะทะฐะฟะธัั ะฒ ัะฐะฑะปะธัะต `documents`:
โ  โโ filename: "ะะฐะทะดะตะป ะะ. ะะพะดะพัะฝะฐะฑะถะตะฝะธะต.pdf"
โ  โโ project_id: 123
โ  โโ doc_type: "ะะ"
โ  โโ file_path: "projects/123/docs/rd_12345.pdf"
โโ ะกัะฐะฒะธั ะทะฐะดะฐัั ะฒ Celery: analyze_rd_task.delay(document_id=456)
โโ ะะพะทะฒัะฐัะฐะตั: {"status": "processing", "task_id": "abc-123"}

ะคัะพะฝัะตะฝะด ะฟะพะบะฐะทัะฒะฐะตั: "ะะพะบัะผะตะฝั ะทะฐะณััะถะตะฝ, ะฐะฝะฐะปะธะทะธััะตััั..."
```

---

### ะจะะ 2: ะะ ะฐะฝะฐะปะธะทะธััะตั ะฟัะพะตะบัะฝัั ะดะพะบัะผะตะฝัะฐัะธั

**ะงัะพ ะฟัะพะธััะพะดะธั ะฒ ัะพะฝะต:**
```
Celery Worker ะฟะพะดะฝะธะผะฐะตั ะทะฐะดะฐัั:
โโ "ะัะถะฝะพ ะฟัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะดะพะบัะผะตะฝั ID 456"

ะะฐะฟััะบะฐะตััั ะะณะตะฝั ะฐะฝะฐะปะธะทะฐ ะะ:
โโ ะกะบะฐัะธะฒะฐะตั PDF ะธะท Object Storage
โโ ะะทะฒะปะตะบะฐะตั ัะตะบัั ัะตัะตะท PyMuPDF
โโ ะัะฟัะฐะฒะปัะตั ะฒ GPT-4o ั ะฟัะพะผะฟัะพะผ:
โ  """
โ  ะขั ัะบัะฟะตัั ะฟะพ ัััะพะธัะตะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ.
โ  ะัะพะฐะฝะฐะปะธะทะธััะน ัะฟะตัะธัะธะบะฐัะธั ะธ ะพะฟัะตะดะตะปะธ:
โ  1. ะะฐะบะธะต ะฒะธะดั ัะฐะฑะพั ะฝัะถะฝะพ ะทะฐะบััะฒะฐัั ะะะกะ
โ  2. ะะฐะบะธะต ะผะฐัะตัะธะฐะปั ะธัะฟะพะปัะทััััั
โ  3. ะะพะปะธัะตััะฒะพ ะธ ะตะดะธะฝะธัั ะธะทะผะตัะตะฝะธั
โ
โ  [PDF ัะตะบัั...]
โ  """
โ
โโ GPT-4o ะฒะพะทะฒัะฐัะฐะตั JSON:
โ  {
โ    "works": [
โ      {
โ        "type": "ะะพะฝัะฐะถ ัััะฑะพะฟัะพะฒะพะดะพะฒ",
โ        "materials": [
โ          {"name": "ะขััะฑะฐ ะะะ", "quantity": 150, "unit": "ะผ", "gost": "ะะะกะข 18599-2001"},
โ          {"name": "ะคะธัะธะฝะณะธ", "quantity": 25, "unit": "ัั"}
โ        ]
โ      }
โ    ]
โ  }
โ
โโ ะกะพััะฐะฝัะตั ัะตะทัะปััะฐั ะฒ ัะฐะฑะปะธัั `aosr`:
   โโ project_id: 123
   โโ work_type: "ะะพะฝัะฐะถ ัััะฑะพะฟัะพะฒะพะดะพะฒ"
   โโ content: {JSON ั ัะฐะฑะพัะฐะผะธ ะธ ะผะฐัะตัะธะฐะปะฐะผะธ}
   โโ status: "draft"
```

---

### ะจะะ 3: ะะฝะถะตะฝะตั ะทะฐะฟััะบะฐะตั ะณะตะฝะตัะฐัะธั ะะะกะ

**ะงัะพ ะดะตะปะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั:**
```
1. ะะธะดะธั ะฒ ะธะฝัะตััะตะนัะต: "ะะฐะนะดะตะฝะพ 1 ะฐะบั ะดะปั ะณะตะฝะตัะฐัะธะธ"
2. ะะฐะถะธะผะฐะตั "ะกะณะตะฝะตัะธัะพะฒะฐัั ะะะกะ โ1"
3. ะะฐะฟะพะปะฝัะตั ัะพัะผั:
   - ะะฐัะฐ ัะฐะฑะพั: 2024-12-10
   - ะัะฒะตัััะฒะตะฝะฝัะต ะปะธัะฐ: (ะฒัะฑะธัะฐะตั ะธะท ัะฟัะฐะฒะพัะฝะธะบะฐ)
4. ะะฐะถะธะผะฐะตั "ะกะณะตะฝะตัะธัะพะฒะฐัั"
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
Backend:
โโ ะะพะปััะฐะตั ะทะฐะฟัะพั: POST /api/v1/aosr/generate
โโ ะกัะฐะฒะธั ะทะฐะดะฐัั: generate_aosr_task.delay(aosr_id=789)
โโ ะะพะทะฒัะฐัะฐะตั: {"status": "generating", "task_id": "xyz-456"}

Celery Worker:
โโ ะะณะตะฝั ะณะตะฝะตัะฐัะธะธ ะะะกะ:
   โโ ะะฐะณััะถะฐะตั ะดะฐะฝะฝัะต ะธะท ะฑะฐะทั (work_type, materials, etc)
   โโ ะัะฟะพะปัะทัะตั ัะฐะฑะปะพะฝ ะะะกะข ะดะปั ะะะกะ
   โโ ะะฐะฟะพะปะฝัะตั ัะฐะฑะปะพะฝ ะดะฐะฝะฝัะผะธ
   โโ ะะตะฝะตัะธััะตั PDF ัะตัะตะท ReportLab
   โโ ะกะพััะฐะฝัะตั PDF ะฒ Object Storage
   โโ ะะฑะฝะพะฒะปัะตั ะทะฐะฟะธัั ะฒ ะะ:
      โโ status: "generated"
      โโ generated_pdf_path: "projects/123/aosr/aosr_789.pdf"
      โโ generated_at: "2024-12-14 10:30:00"
```

---

### ะจะะ 4: ะะพะธัะบ ะดะพะบัะผะตะฝัะพะฒ ะบะฐัะตััะฒะฐ

**ะะฐัะฐะปะปะตะปัะฝะพ ะทะฐะฟััะบะฐะตััั:**
```
ะะณะตะฝั ะฟะพะธัะบะฐ ะดะพะบัะผะตะฝัะพะฒ ะบะฐัะตััะฒะฐ:
โโ ะะตััั ัะฟะธัะพะบ ะผะฐัะตัะธะฐะปะพะฒ ะธะท ะะะกะ:
โ  ["ะขััะฑะฐ ะะะ ะะะกะข 18599-2001", "ะคะธัะธะฝะณะธ"]
โ
โโ ะะะฏ ะะะะะะะ ะะะขะะะะะะ:
โ  โโ 1. ะัะตั ะฒ ะปะพะบะฐะปัะฝะพะน ะฑะฐะทะต ะทะฐะณััะถะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ ะฟัะพะตะบัะฐ
โ  โ     SELECT * FROM documents
โ  โ     WHERE project_id = 123
โ  โ     AND ocr_text LIKE '%ะขััะฑะฐ ะะะ%'
โ  โ     AND ocr_text LIKE '%ะะะกะข 18599-2001%'
โ  โ
โ  โโ 2. ะัะปะธ ะะ ะฝะฐะนะดะตะฝะพ โ ะฟะพะธัะบ ะฒ ะธะฝัะตัะฝะตัะต:
โ  โ     โโ Playwright ะพัะบััะฒะฐะตั ะฑัะฐัะทะตั
โ  โ     โโ ะะฐัะพะดะธั ะฝะฐ https://www.santech.ru/
โ  โ     โโ ะัะตั "ะขััะฑะฐ ะะะ ะะะกะข 18599-2001 ัะตััะธัะธะบะฐั"
โ  โ     โโ ะกะบะฐัะธะฒะฐะตั PDF ัะตััะธัะธะบะฐัะฐ
โ  โ     โโ ะัะฟัะฐะฒะปัะตั GPT-4o: "ะะพะดัะพะดะธั ะปะธ ััะพั ัะตััะธัะธะบะฐั?"
โ  โ     โโ ะัะปะธ ะฟะพะดัะพะดะธั โ ัะพััะฐะฝัะตั ะฒ ะฟัะพะตะบั
โ  โ
โ  โโ 3. ะัะปะธ ะฒัั ัะฐะฒะฝะพ ะะ ะฝะฐะนะดะตะฝะพ:
โ        โโ ะะณะตะฝั ะณะตะฝะตัะฐัะธะธ ะดะพะบัะผะตะฝัะพะฒ ัะพะทะดะฐัั ะฟะฐัะฟะพัั ะบะฐัะตััะฒะฐ
โ
โโ ะกะพะทะดะฐัั ัะฒัะทะธ ะฒ ัะฐะฑะปะธัะต `aosr_quality_documents`:
   โโ aosr_id: 789
   โโ document_id: 234 (ัะตััะธัะธะบะฐั ะฝะฐ ัััะฑั)
   โโ relevance_score: 0.95
```

---

### ะจะะ 5: ะัะพะฒะตัะบะฐ ะบะพะผะฟะปะตะบัะฝะพััะธ

```
ะะณะตะฝั ะฟัะพะฒะตัะบะธ:
โโ ะัะพะฒะตััะตั ะะะกะ ID 789:
โ  โโ ะััั ะปะธ ะฒัะต ะดะพะบัะผะตะฝัั ะฝะฐ ะผะฐัะตัะธะฐะปั? โ
โ  โโ ะัะพะฒะตัะบะฐ ะดะฐั:
โ  โ  โโ ะะฐัะฐ ัะฐะฑะพั: 2024-12-10
โ  โ  โโ ะะฐัะฐ ะฟะพััะฐะฒะบะธ (ะธะท ะฟะฐัะฟะพััะฐ): 2024-11-15 โ
โ  โ  โโ ะกัะพะบ ะดะตะนััะฒะธั ัะตััะธัะธะบะฐัะฐ: ะดะพ 2027-01-01 โ
โ  โ  โโ ะัั ะปะพะณะธัะฝะพ? โ
โ  โ
โ  โโ ะะตะทัะปััะฐั: "ะะพะผะฟะปะตะบั ะณะพัะพะฒ ะบ ัะดะฐัะต, ะทะฐะผะตัะฐะฝะธะน ะฝะตั"
โ
โโ ะะฑะฝะพะฒะปัะตั ััะฐััั: status = "approved"
```

---

### ะจะะ 6: ะคะพัะผะธัะพะฒะฐะฝะธะต ัะธะฝะฐะปัะฝะพะณะพ ะบะพะผะฟะปะตะบัะฐ

**ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั: "ะกะบะฐัะฐัั ะบะพะผะฟะปะตะบั ะะ"**

**ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ััะพะณะพ ััะฐะฟะฐ:** ะกะผ. [10-final-package-generation.md](10-final-package-generation.md)

```
Backend:
โโ ะกะพะฑะธัะฐะตั ะผะตัะฐะดะฐะฝะฝัะต ะฒัะตั ะดะพะบัะผะตะฝัะพะฒ ะฟัะพะตะบัะฐ:
โ  โโ ะัะต ะะะกะ ั ะฝะพะผะตัะฐะผะธ ะธ ะดะฐัะฐะผะธ
โ  โโ ะัะฟะพะปะฝะธัะตะปัะฝัะต ััะตะผั (ะฟัะธะปะพะถะตะฝะธั ะบ ะะะกะ)
โ  โโ ะะพะบัะผะตะฝัั ะบะฐัะตััะฒะฐ (ัะตััะธัะธะบะฐัั, ะฟะฐัะฟะพััะฐ, ะดะตะบะปะฐัะฐัะธะธ)
โ  โโ ะะฐัััะธััะฒะฐะตั ะฝัะผะตัะฐัะธั ัััะฐะฝะธั ะดะปั ัะตะตัััะฐ
โ
โโ ะะตะฝะตัะธััะตั ัะธััะปัะฝัะน ะปะธัั:
โ  โโ ะะฐะทะฒะฐะฝะธะต ะพะฑัะตะบัะฐ
โ  โโ ะะฐัััะพะนัะธะบ, ะฟะพะดััะดัะธะบ, ะณะตะฝะฟะพะดััะดัะธะบ
โ  โโ ะะตัะธะพะด ะฒัะฟะพะปะฝะตะฝะธั ัะฐะฑะพั
โ
โโ ะะตะฝะตัะธััะตั ัะตะตััั ะธัะฟะพะปะฝะธัะตะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ:
โ  โโ ะขะฐะฑะปะธัะฐ ั 7 ะบะพะปะพะฝะบะฐะผะธ (โ ะฟ/ะฟ, ะะฐะธะผะตะฝะพะฒะฐะฝะธะต, ะกะพะดะตัะถะฐะฝะธะต, โ ะดะพะบัะผะตะฝัะฐ, ะะฐัะฐ, ะะพะป-ะฒะพ ะปะธััะพะฒ, ะกััะฐะฝะธัะฐ)
โ  โโ ะัะต ะดะพะบัะผะตะฝัั ะฟัะพะฝัะผะตัะพะฒะฐะฝั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ
โ  โโ ะฃะบะฐะทะฐะฝั ัะพัะฝัะต ะฝะพะผะตัะฐ ัััะฐะฝะธั ะฒ ะธัะพะณะพะฒะพะผ PDF
โ
โโ ะะฑัะตะดะธะฝัะตั ะฒัะต ะดะพะบัะผะตะฝัั ะฒ ะตะดะธะฝัะน PDF (PyPDF2):
โ  โโ 1. ะขะธััะปัะฝัะน ะปะธัั
โ  โโ 2. ะะตะตััั ะธัะฟะพะปะฝะธัะตะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ (2-3 ัััะฐะฝะธัั)
โ  โโ 3. ะะะกะ โ1
โ  โโ 4. ะัะฟะพะปะฝะธัะตะปัะฝะฐั ััะตะผะฐ ะบ ะะะกะ โ1
โ  โโ 5-8. ะะพะบัะผะตะฝัั ะบะฐัะตััะฒะฐ (ัะตััะธัะธะบะฐัั, ะฟะฐัะฟะพััะฐ)
โ  โโ 9. ะะะกะ โ2
โ  โโ 10. ะัะฟะพะปะฝะธัะตะปัะฝะฐั ััะตะผะฐ ะบ ะะะกะ โ2
โ  โโ ... (ะฒัะต ะพััะฐะปัะฝัะต ะะะกะ)
โ
โโ ะกะพะทะดะฐัั ะฐััะธะฒ ZIP ั ัะตะดะฐะบัะธััะตะผัะผะธ ัะฐะนะปะฐะผะธ:
โ  โโ 1. ะัะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฒ ัะพัะผะฐัะต PDF/
โ  โ  โโ [ะฒัะต PDF ัะฐะนะปั ะพัะดะตะปัะฝะพ]
โ  โโ 2. ะัะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฒ ัะพัะผะฐัะต Excel/
โ  โ  โโ ะะฑัะธะน ัะตะตััั.xlsx (ัะตะดะฐะบัะธััะตะผะฐั ัะฐะฑะปะธัะฐ)
โ  โ  โโ ะะะกะ โ1.xlsx, ะะะกะ โ2.xlsx (ะฝะฐ ะพัะฝะพะฒะต ัะฐะฑะปะพะฝะฐ)
โ  โโ 4. ะะตะพะดะตะทะธัะตัะบะธะต ััะตะผั ะฒ ัะพัะผะฐัะต DWG/
โ  โ  โโ [ะธัะฟะพะปะฝะธัะตะปัะฝัะต ััะตะผั ะฒ AutoCAD ัะพัะผะฐัะต, ะตัะปะธ ะตััั]
โ  โโ 5. ะะฐัะฟะพััะฐ, ัะตััะธัะธะบะฐัั ะธ ะปะฐะฑะพัะฐัะพัะฝัะต ะทะฐะบะปััะตะฝะธั/
โ     โโ [ะฒัะต ะดะพะบัะผะตะฝัั ะบะฐัะตััะฒะฐ]
โ
โโ ะะฐะณััะถะฐะตั ัะฐะนะปั ะฒ Object Storage
โโ ะะพะทะฒัะฐัะฐะตั URL ะดะปั ัะบะฐัะธะฒะฐะฝะธั:
   โโ PDF: "ะะ_ะะ_ะกะพะปะฝะตัะฝัะน_ะะพะปะฝัะน_ะบะพะผะฟะปะตะบั.pdf" (45MB, 250 ัััะฐะฝะธั)
   โโ ZIP: "ะะ_ะะ_ะกะพะปะฝะตัะฝัะน_ะััะธะฒ.zip" (30MB, ะฒัะต ัะตะดะฐะบัะธััะตะผัะต ัะฐะนะปั)

ะะพะปัะทะพะฒะฐัะตะปั ัะบะฐัะธะฒะฐะตั ะณะพัะพะฒัะน ะบะพะผะฟะปะตะบั ะฒ ะดะฒัั ัะพัะผะฐัะฐั!
```

**ะัะตะผั ะณะตะฝะตัะฐัะธะธ:** ~2 ะผะธะฝััั (ั ะพััะปะตะถะธะฒะฐะฝะธะตะผ ะฟัะพะณัะตััะฐ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ)

---

## ๐งฉ ะะฐะบ ะบะพะผะฟะพะฝะตะฝัั ะฒะทะฐะธะผะพะดะตะนััะฒััั

### ะัะธะผะตั: ะะตะฝะตัะฐัะธั ะะะกะ

#### ะะฝัะตัะฐะบัะธะฒะฝะฐั ะดะธะฐะณัะฐะผะผะฐ (Mermaid)

```mermaid
sequenceDiagram
    participant User as ๐ค ะะฝะถะตะฝะตั ะะขะ
    participant Frontend as ๐ฅ๏ธ React
    participant Backend as โ๏ธ FastAPI
    participant DB as ๐พ PostgreSQL
    participant Queue as ๐ฌ Redis
    participant Celery as โก Celery Worker
    participant Agent as ๐ค AI Agent
    participant OpenAI as ๐ง GPT-4o
    participant ReportLab as ๐ ReportLab
    participant Storage as ๐ฆ Storage

    User->>Frontend: ะะฐะถะธะผะฐะตั "ะกะณะตะฝะตัะธัะพะฒะฐัั ะะะกะ"
    Frontend->>Backend: POST /api/v1/aosr/generate
    Backend->>DB: ะกะพััะฐะฝัะตั ะทะฐะฟะธัั AOSR (status: "pending")
    Backend->>Queue: ะกัะฐะฒะธั ะทะฐะดะฐัั ะฒ ะพัะตัะตะดั
    Backend-->>Frontend: {"task_id": "abc-123", "status": "pending"}
    Frontend-->>User: "ะะตะฝะตัะธััะตััั..."

    Celery->>Queue: ะะฐะฑะธัะฐะตั ะทะฐะดะฐัั
    Celery->>Agent: ะะฐะฟััะบะฐะตั ะฐะณะตะฝัะฐ ะณะตะฝะตัะฐัะธะธ
    Agent->>DB: ะงะธัะฐะตั ะดะฐะฝะฝัะต ะฟัะพะตะบัะฐ
    Agent->>OpenAI: ะะฐะฟัะพั ะบ GPT-4o ั ะฟัะพะผะฟัะพะผ
    OpenAI-->>Agent: ะะพะทะฒัะฐัะฐะตั ััััะบัััะธัะพะฒะฐะฝะฝัะน ัะตะบัั
    Agent->>ReportLab: ะคะพัะผะธััะตั PDF ะธะท ัะตะบััะฐ
    ReportLab-->>Agent: ะะพัะพะฒัะน PDF
    Agent->>Storage: ะกะพััะฐะฝัะตั PDF
    Agent->>DB: ะะฑะฝะพะฒะปัะตั status: "completed"

    Frontend->>Backend: GET /api/v1/aosr/{id}/status
    Backend->>DB: ะงะธัะฐะตั ััะฐััั
    Backend-->>Frontend: {"status": "completed", "pdf_url": "..."}
    Frontend-->>User: "ะะพัะพะฒะพ! ะกะบะฐัะฐัั PDF"
```

#### ะขะตะบััะพะฒะฐั ะดะธะฐะณัะฐะผะผะฐ (ะดะปั ัะตัะผะธะฝะฐะปะฐ)

```
โโโโโโโโโโโโโโ
โ  ะคัะพะฝัะตะฝะด  โ
โ   (React)  โ
โโโโโโโโฌโโโโโโ
       โ POST /api/v1/aosr/generate
       โผ
โโโโโโโโโโโโโโ
โ  Backend   โโโโโโโโ
โ  (FastAPI) โ      โ ะกะพััะฐะฝัะตั ะฒ ะะ
โโโโโโโโฌโโโโโโ      โ
       โ            โผ
       โ      โโโโโโโโโโโโโโโโ
       โ      โ  PostgreSQL  โ
       โ      โโโโโโโโโโโโโโโโ
       โ ะกัะฐะฒะธั ะทะฐะดะฐัั
       โผ
โโโโโโโโโโโโโโ
โ   Celery   โ
โ   Worker   โ
โโโโโโโโฌโโโโโโ
       โ ะัะทัะฒะฐะตั ะฐะณะตะฝัะฐ
       โผ
โโโโโโโโโโโโโโ
โ AI Agent   โโโโโโโโ
โ (LangChain)โ      โ ะะฐะฟัะพั ะบ LLM
โโโโโโโโฌโโโโโโ      โ
       โ            โผ
       โ      โโโโโโโโโโโโโโโโ
       โ      โ   OpenAI     โ
       โ      โ   GPT-4o     โ
       โ      โโโโโโโโโโโโโโโโ
       โ ะะตะฝะตัะธััะตั PDF
       โผ
โโโโโโโโโโโโโโ
โ ReportLab  โ
โ PDF Gen    โ
โโโโโโโโฌโโโโโโ
       โ ะกะพััะฐะฝัะตั ัะฐะนะป
       โผ
โโโโโโโโโโโโโโ
โ  Object    โ
โ  Storage   โ
โโโโโโโโโโโโโโ
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต

```
ะะพะปัะทะพะฒะฐัะตะปั โ ะคัะพะฝัะตะฝะด:
โโ HTTPS (SSL/TLS) โ ัะธััะพะฒะฐะฝะธะต ััะฐัะธะบะฐ
โโ JWT ัะพะบะตะฝ โ ะฐััะตะฝัะธัะธะบะฐัะธั

ะคัะพะฝัะตะฝะด โ Backend:
โโ ะะฐะปะธะดะฐัะธั ะฒัะตั ะดะฐะฝะฝัั (Pydantic)
โโ Rate Limiting (ะฝะต ะฑะพะปะตะต 100 ะทะฐะฟัะพัะพะฒ/ะผะธะฝ)
โโ CORS (ัะพะปัะบะพ ั ัะฐะทัะตััะฝะฝัั ะดะพะผะตะฝะพะฒ)

Backend โ ะะฐะทะฐ ะดะฐะฝะฝัั:
โโ ะะพะดะณะพัะพะฒะปะตะฝะฝัะต ะทะฐะฟัะพัั (ะทะฐัะธัะฐ ะพั SQL Injection)
โโ ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน (bcrypt)
โโ ะจะธััะพะฒะฐะฝะธะต ััะฒััะฒะธัะตะปัะฝัั ะดะฐะฝะฝัั

Backend โ Object Storage:
โโ ะัะธะฒะฐัะฝัะต ะฑะฐะบะตัั (ัะฐะนะปั ะฝะต ะดะพัััะฟะฝั ะฟัะฑะปะธัะฝะพ)
โโ ะะพะดะฟะธัะฐะฝะฝัะต URL (ะฒัะตะผะตะฝะฝัะน ะดะพัััะฟ)
โโ ะัะพะฒะตัะบะฐ ัะพัะผะฐัะฐ ัะฐะนะปะพะฒ (ะทะฐัะธัะฐ ะพั ะฒะธัััะพะฒ)
```

---

## โก ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะงัะพ ะฟัะพะธััะพะดะธั ะฑััััะพ:
- โ ะะฐะณััะทะบะฐ ะธะฝัะตััะตะนัะฐ: <1 ัะตะบ
- โ ะะฐะณััะทะบะฐ ัะฐะนะปะฐ: ะทะฐะฒะธัะธั ะพั ัะบะพัะพััะธ ะธะฝัะตัะฝะตัะฐ
- โ API ะทะฐะฟัะพัั: <100ms

### ะงัะพ ะทะฐะฝะธะผะฐะตั ะฒัะตะผั:
- โณ ะะฝะฐะปะธะท ะะ: 30-60 ัะตะบ (ะทะฐะฒะธัะธั ะพั ัะฐะทะผะตัะฐ ะดะพะบัะผะตะฝัะฐ)
- โณ ะะตะฝะตัะฐัะธั ะะะกะ: 10-20 ัะตะบ
- โณ ะะพะธัะบ ะดะพะบัะผะตะฝัะพะฒ ะฒ ะธะฝัะตัะฝะตัะต: 2-5 ะผะธะฝ (ะฝะฐ ะบะฐะถะดัะน ะผะฐัะตัะธะฐะป)
- โณ OCR ัะบะฐะฝะฐ: 5-10 ัะตะบ ะฝะฐ ัััะฐะฝะธัั

**ะะตัะตะฝะธะต:** ะัั ะดะตะปะฐะตััั ะฒ ัะพะฝะต (Celery), ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะถะดัั!

---

## โ๏ธ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ (Error Handling)

### ะงัะพ ะผะพะถะตั ะฟะพะนัะธ ะฝะต ัะฐะบ?

#### 1. ะัะธะฑะบะฐ ะฟัะธ ะทะฐะณััะทะบะต ัะฐะนะปะฐ

**ะัะพะฑะปะตะผะฐ:** ะคะฐะนะป ัะปะธัะบะพะผ ะฑะพะปััะพะน ะธะปะธ ะฝะตะฒะตัะฝัะน ัะพัะผะฐั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```python
# Backend ะฟัะพะฒะตััะตั ัะฐะทะผะตั ะธ ัะธะฟ
if file_size > 50 * 1024 * 1024:  # > 50MB
    raise HTTPException(
        status_code=400,
        detail="ะคะฐะนะป ัะปะธัะบะพะผ ะฑะพะปััะพะน (ะผะฐะบัะธะผัะผ 50MB)"
    )

if mime_type not in ['application/pdf', 'application/msword']:
    raise HTTPException(
        status_code=400,
        detail="ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ัะพัะผะฐั ัะฐะนะปะฐ"
    )
```

**ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> โ ะัะธะฑะบะฐ ะทะฐะณััะทะบะธ: ะคะฐะนะป ัะปะธัะบะพะผ ะฑะพะปััะพะน (ะผะฐะบัะธะผัะผ 50MB)

---

#### 2. ะัะธะฑะบะฐ ะฐะฝะฐะปะธะทะฐ ะะ (GPT-4o ะฝะต ะพัะฒะตัะฐะตั)

**ะัะพะฑะปะตะผะฐ:** OpenAI API ะฝะตะดะพัััะฟะตะฝ ะธะปะธ ะฒะตัะฝัะป ะพัะธะฑะบั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),  # ะัะพะฑัะตะผ 3 ัะฐะทะฐ
    wait=wait_exponential(min=4, max=60)  # ะะดัะผ 4, 16, 60 ัะตะบัะฝะด
)
def analyze_rd_with_retry(document_text):
    try:
        response = openai.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": prompt}],
            timeout=120  # ะขะฐะนะผะฐัั 2 ะผะธะฝััั
        )
        return response
    except openai.APIError as e:
        logger.error(f"OpenAI API error: {e}")
        raise  # Retry ััะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ
    except openai.Timeout:
        logger.error("OpenAI timeout")
        raise
```

**Fallback (ะตัะปะธ ะฒัะต retry ะฝะต ะฟะพะผะพะณะปะธ):**
```python
# ะัะฟะพะปัะทัะตะผ ัะฟัะพััะฝะฝัะน ะฐะฝะฐะปะธะท ะฑะตะท LLM
def fallback_analysis(document_text):
    # ะัะพััะพะน ะฟะพะธัะบ ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ
    materials = extract_materials_by_keywords(document_text)
    return {"works": [{"materials": materials}]}
```

**ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> โ๏ธ ะะฝะฐะปะธะท ะฒัะฟะพะปะฝะตะฝ ะฒ ัะฟัะพััะฝะฝะพะผ ัะตะถะธะผะต. ะัะพะฒะตัััะต ัะตะทัะปััะฐัั ะฒัััะฝัั.

---

#### 3. ะะพะบัะผะตะฝั ะบะฐัะตััะฒะฐ ะฝะต ะฝะฐะนะดะตะฝ

**ะัะพะฑะปะตะผะฐ:** ะะณะตะฝั ะฟะพะธัะบะฐ ะฝะต ะฝะฐััะป ัะตััะธัะธะบะฐั ะฒ ะธะฝัะตัะฝะตัะต

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```python
def search_document_with_fallback(material):
    # ะจะฐะณ 1: ะะพะธัะบ ะฒ ะธะฝัะตัะฝะตัะต
    result = search_online(material)
    if result:
        return result

    # ะจะฐะณ 2: ะัะปะธ ะฝะต ะฝะฐะนะดะตะฝะพ โ ะณะตะฝะตัะธััะตะผ ะฟะฐัะฟะพัั ะบะฐัะตััะฒะฐ
    logger.warning(f"Document not found for {material}, generating template")
    return generate_quality_document_template(material)
```

**ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> โน๏ธ ะกะตััะธัะธะบะฐั ะฝะฐ "ะขััะฑะฐ ะะะ" ะฝะต ะฝะฐะนะดะตะฝ. ะกะพะทะดะฐะฝ ัะฐะฑะปะพะฝ ะฟะฐัะฟะพััะฐ ะบะฐัะตััะฒะฐ. ะะฐะฟะพะปะฝะธัะต ะฒัััะฝัั.

---

#### 4. ะัะธะฑะบะฐ ัะพัะผะธัะพะฒะฐะฝะธั PDF

**ะัะพะฑะปะตะผะฐ:** ะะต ัะดะฐะปะพัั ะพะฑัะตะดะธะฝะธัั ัะฐะนะปั ะฒ ะพะดะธะฝ PDF

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```python
try:
    merger = PdfMerger()
    for file_path in files:
        merger.append(file_path)
    merger.write(output_path)
except Exception as e:
    logger.error(f"PDF merge failed: {e}")

    # Fallback: ะะพะทะฒัะฐัะฐะตะผ ัะฐะนะปั ะพัะดะตะปัะฝะพ (ZIP ะฐััะธะฒ)
    zip_path = create_zip_archive(files)
    return {"format": "zip", "path": zip_path}
```

**ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> โ๏ธ ะะต ัะดะฐะปะพัั ัะพะทะดะฐัั ะตะดะธะฝัะน PDF. ะกะบะฐัะฐะนัะต ัะฐะนะปั ะฐััะธะฒะพะผ (ZIP).

---

#### 5. ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะตะดะพัััะฟะฝะฐ

**ะัะพะฑะปะตะผะฐ:** PostgreSQL ะฝะต ะพัะฒะตัะฐะตั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```python
from sqlalchemy.exc import OperationalError
from tenacity import retry, stop_after_attempt

@retry(stop=stop_after_attempt(3))
def get_project(project_id):
    try:
        return db.query(Project).filter(Project.id == project_id).first()
    except OperationalError as e:
        logger.error(f"Database connection error: {e}")
        raise  # Retry ะฐะฒัะพะผะฐัะธัะตัะบะธ
```

**ะัะปะธ retry ะฝะต ะฟะพะผะพะณ:**
```python
# ะะพะบะฐะทัะฒะฐะตะผ ัััะฐะฝะธัั ั ะพัะธะฑะบะพะน
raise HTTPException(
    status_code=503,
    detail="ะกะตัะฒะธั ะฒัะตะผะตะฝะฝะพ ะฝะตะดะพัััะฟะตะฝ. ะะพะฟัะพะฑัะนัะต ัะตัะตะท 5 ะผะธะฝัั."
)
```

**ะงัะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> ๐จ ะกะตัะฒะธั ะฒัะตะผะตะฝะฝะพ ะฝะตะดะพัััะฟะตะฝ. ะะพะฟัะพะฑัะนัะต ัะตัะตะท 5 ะผะธะฝัั.

---

### ะะพะณะธัะพะฒะฐะฝะธะต ะพัะธะฑะพะบ

**ะัะต ะพัะธะฑะบะธ ะปะพะณะธัััััั:**
```python
import logging

logger = logging.getLogger(__name__)

# ะัะธ ะบะฐะถะดะพะน ะพัะธะฑะบะต
logger.error(
    f"Error in analyze_rd: {error}",
    extra={
        "user_id": user.id,
        "document_id": doc.id,
        "error_type": type(error).__name__
    },
    exc_info=True  # ะะบะปััะฐะตั stack trace
)
```

**ะะปะตััั ะดะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ:**
```python
# ะัะธัะธัะฝัะต ะพัะธะฑะบะธ ะพัะฟัะฐะฒะปััััั ะฒ Telegram/Email
if is_critical_error(error):
    send_alert_to_admin(
        f"๐จ ะัะธัะธัะฝะฐั ะพัะธะฑะบะฐ ะฒ analyze_rd\n"
        f"User: {user.email}\n"
        f"Error: {error}"
    )
```

---

## ๐ฏ ะงัะพ ะดะฐะปััะต?

ะัะพัะธัะฐะนัะต ัะปะตะดัััะธะต ะดะพะบัะผะตะฝัั:

1. [02-data-flow.md](02-data-flow.md) โ ะะพะดัะพะฑะฝะตะต ะพ ัะพะผ, ะบะฐะบ ะดะฐะฝะฝัะต ะฟััะตัะตััะฒััั
2. [03-agents-interaction.md](03-agents-interaction.md) โ ะะฐะบ ะะ-ะฐะณะตะฝัั ัะฐะฑะพัะฐัั ะฒะผะตััะต
3. [04-scaling-strategy.md](04-scaling-strategy.md) โ ะะฐะบ ะผะฐัััะฐะฑะธัะพะฒะฐัั ะฟะปะฐััะพัะผั
4. [05-security-architecture.md](05-security-architecture.md) โ ะะตะทะพะฟะฐัะฝะพััั ะฟะปะฐััะพัะผั

---

**ะกัะฐััั:** โ ะะบััะฐะปัะฝะพ
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2025-12-14
